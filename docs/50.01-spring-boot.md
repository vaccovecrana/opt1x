# Spring Boot Integration with Opt1x

Opt1x provides drop-in compatibility with Spring Cloud Config Server, allowing Spring Boot applications to fetch configuration from Opt1x’s REST API.

This page outlines how to configure a Spring Boot application to integrate with Opt1x, using a sample application named `config-client`.

## Prerequisites

- Opt1x running locally.
- A valid API key (`id` and `secret`) configured in Opt1x for secure access.
- A Spring Boot application with Spring Cloud Config dependency.

## Configuring the Spring Boot Application

To enable your Spring Boot application to fetch configuration from Opt1x, include the following settings in your `application.properties` or `application.yml` file:

```properties
spring.config.import=configserver:http://localhost:7070/spring
spring.application.name=config-client
spring.cloud.config.username=your-api-key-id
spring.cloud.config.password=your-api-key-secret
spring.profiles.active=dev
logging.level.org.springframework.cloud.bootstrap=DEBUG
```

## Setting Up Configuration in Opt1x

In Opt1x, create a configuration for your application using the Web UI. For the `config-client` application with the `dev` profile, define the following:

```yaml
app:
  message: Hello from Opt1x (Dev)!
  debug: true
```

- **Application**: Set to `config-client` to match `spring.application.name`.
- **Profile**: Set to `dev` to match `spring.profiles.active`.
- **Properties**: Define key-value pairs (e.g., `app.message`, `app.debug`) that your Spring app will consume via `@Value` or `@ConfigurationProperties`.

## Testing the Integration

1. Start Opt1x: Run `./opt1x --api-spring` to enable Spring integration.
2. Configure Opt1x: Use the UI or POST to `/api/v1/config` to create the above config for `config-client/dev`.
3. Run the Spring Boot app: Execute `./gradlew bootRun` (or equivalent) in your app’s directory.
4. Verify config fetch: Check the app’s logs for:
   ```
   Fetching config from server at : http://localhost:7070/spring
   Located environment: name=config-client, profiles=[dev], ...
   ```
5. Test the app: Access an endpoint (e.g., `curl http://localhost:8080/message`) to confirm properties are applied (e.g., `Hello from Opt1x (Dev)! (Debug mode enabled)`).

## Troubleshooting

- **401 Unauthorized**: Ensure `spring.cloud.config.username/password` match a valid Opt1x API key (`OtApiKey` schema). Test with `curl -u id:secret http://localhost:7070/spring/config-client/dev`.
- **Config not found**: Verify the application name and profile in Opt1x match your app’s settings. Check Opt1x logs for errors.
- **Logging**: Enable `DEBUG` logs in Opt1x (via Shax config) to trace config requests.

Opt1x supports multiple profiles (e.g., `default`, `dev`, `prod`). Create additional configs in Opt1x for each profile as needed.
